===============================================
    PAYSLIP GENERATION - QUICK REFERENCE
===============================================

OVERVIEW
--------
Complete payslip generation system for accountants with real-time 
salary calculations, validation, and recent payslip tracking.

KEY FEATURES
------------
✓ Employee selection with auto-fill basic salary
✓ Earnings: Basic, HRA, DA, Bonus
✓ Deductions: Tax, Other deductions
✓ Real-time calculation display
✓ Recent payslips dashboard (last 10)
✓ Transaction-safe database operations

QUICK START
-----------
1. Login as Accountant
2. Navigate: Dashboard → Generate Payslip
3. Select employee (basic salary auto-fills)
4. Set month/year
5. Enter HRA, DA, bonus (if applicable)
6. Enter deductions
7. Review calculation summary
8. Click "Generate Payslip"

FORM FIELDS
-----------
REQUIRED:
  • Employee          - Select from dropdown
  • Month             - Current month selected by default
  • Year              - Current year by default
  • Basic Salary      - Auto-filled from employee record

OPTIONAL (default: ₹0):
  • HRA               - House Rent Allowance
  • DA                - Dearness Allowance
  • Bonus             - Performance/festival bonus
  • Tax Deduction     - Income tax
  • Other Deductions  - PF, insurance, loans, etc.

CALCULATIONS
------------
Gross Salary     = Basic + HRA + DA + Bonus
Total Deductions = Tax + Other Deductions
Net Salary       = Gross - Deductions

All calculations update in real-time as you type!

DATABASE STRUCTURE
------------------
PAYROLL TABLE:
  payroll_id, employee_id, month, year
  basic, da_amount, hra_amount
  gross_salary, total_deductions, net_salary
  created_at

PAYSLIPS TABLE:
  payslip_id, payroll_id, employee_id
  file_path (for future PDF storage)
  generated_at

SALARY COMPONENT FORMULAS
--------------------------
Example 1: Standard Employee
  Basic:       ₹30,000.00
  HRA:        ₹10,000.00
  DA:          ₹5,000.00
  Bonus:           ₹0.00
  ──────────────────────
  Gross:      ₹45,000.00
  Tax:        -₹4,500.00
  Other:      -₹1,000.00
  ──────────────────────
  NET:        ₹39,500.00

Example 2: With Bonus
  Basic:       ₹50,000.00
  HRA:        ₹15,000.00
  DA:          ₹7,500.00
  Bonus:      ₹10,000.00
  ──────────────────────
  Gross:      ₹82,500.00
  Tax:       -₹12,375.00
  Other:      -₹2,000.00
  ──────────────────────
  NET:        ₹68,125.00

RECENT PAYSLIPS DISPLAY
------------------------
Shows last 10 generated payslips with:
  • Employee name, designation, department
  • Period (month/year)
  • Gross salary
  • Total deductions (red)
  • Net salary (green)
  • Generation date

ACCESS CONTROL
--------------
Role Required: accountant
Session Check: On every page load
Redirect: To login if not authorized

VALIDATION RULES
----------------
CLIENT-SIDE (JavaScript):
  ✓ Employee must be selected
  ✓ Basic salary must be > 0
  ✓ All numeric fields accept numbers only
  ✓ Required fields enforced

SERVER-SIDE (PHP):
  ✓ Session validation (accountant role)
  ✓ POST data validation
  ✓ Type casting (float for all amounts)
  ✓ Database constraints
  ✓ Transaction safety

WORKFLOW
--------
1. Access Page
   └─> Accountant Dashboard → Generate Payslip

2. Select Employee
   └─> Basic salary auto-fills
   └─> Designation shown in dropdown

3. Set Period
   └─> Month (dropdown)
   └─> Year (number input)

4. Enter Earnings
   └─> HRA, DA, Bonus fields
   └─> Watch calculations update live

5. Enter Deductions
   └─> Tax, Other deductions
   └─> See net salary calculation

6. Review Summary
   └─> Check salary breakdown
   └─> Verify all amounts

7. Generate
   └─> Submit form
   └─> Success banner appears
   └─> New record in Recent Payslips

COMMON ISSUES & FIXES
---------------------
Issue: Basic salary not auto-filling
Fix:   • Check employee has basic_salary in DB
       • Clear browser cache
       • Check browser console for errors

Issue: "Duplicate entry" error
Fix:   • Payslip already exists for that period
       • Check recent payslips list
       • Generate for different month

Issue: Calculations not updating
Fix:   • Check browser console for JS errors
       • Reload the page
       • Try different browser

Issue: "Failed to generate payslip"
Fix:   • Check database connection
       • Verify table structure matches
       • Check error message for details

Issue: Permission denied
Fix:   • Ensure logged in as accountant
       • Check session hasn't expired
       • Re-login if needed

KEYBOARD SHORTCUTS
------------------
Tab       - Navigate between fields
Enter     - Submit form
Esc       - Clear current field (browser default)

FILE LOCATIONS
--------------
Main File:
  /public/accountant/generate_payslip.php

Includes:
  /app/Config/database.php
  /public/admin/includes/admin_sidebar.php
  /public/admin/includes/admin_styles.php
  /public/admin/includes/admin_scripts.php

Documentation:
  /PAYSLIP_GENERATION_GUIDE.md (detailed)
  /PAYSLIP_QUICK_REFERENCE.txt (this file)

TECHNICAL SPECS
---------------
Language:     PHP 7.4+
Database:     MySQL 5.7+ (PDO)
Frontend:     Bootstrap 5, Font Awesome 6.4
JavaScript:   ES6 (Vanilla JS, no frameworks)
Page Size:    ~25 KB
Load Time:    <500ms average

SECURITY FEATURES
-----------------
✓ SQL injection prevention (prepared statements)
✓ XSS prevention (htmlspecialchars)
✓ Session-based authentication
✓ Role-based access control
✓ Transaction safety (BEGIN/COMMIT/ROLLBACK)
✓ Input validation (client + server)

FUTURE ENHANCEMENTS
-------------------
[ ] PDF generation (TCPDF/FPDF)
[ ] Email delivery (PHPMailer)
[ ] Approval workflow
[ ] Bulk generation for departments
[ ] CSV import for salary components
[ ] Automatic tax calculation
[ ] Year-to-date (YTD) summaries
[ ] Payslip templates
[ ] Export to accounting software

TESTING CHECKLIST
-----------------
[ ] Select employee → basic salary fills
[ ] Enter HRA/DA → calculations update
[ ] Enter deductions → net salary recalculates
[ ] Generate payslip → success banner shows
[ ] Check recent payslips → new entry appears
[ ] Try duplicate period → proper error shown
[ ] Test with zero salary → validation prevents
[ ] Test without employee → validation prevents

DATABASE QUERIES
----------------
Insert Payroll:
  INSERT INTO payroll 
  (employee_id, month, year, basic, da_amount, hra_amount,
   gross_salary, total_deductions, net_salary, created_at)
  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, NOW())

Insert Payslip:
  INSERT INTO payslips 
  (payroll_id, employee_id, generated_at)
  VALUES (?, ?, NOW())

Fetch Recent:
  SELECT ps.*, pr.*, e.full_name, d.department_name
  FROM payslips ps
  JOIN payroll pr ON ps.payroll_id = pr.payroll_id
  JOIN employees e ON ps.employee_id = e.employee_id
  LEFT JOIN departments d ON e.department_id = d.department_id
  ORDER BY ps.generated_at DESC
  LIMIT 10

SUPPORT
-------
For issues or questions:
1. Check PAYSLIP_GENERATION_GUIDE.md for details
2. Review browser console for JavaScript errors
3. Check database logs for SQL errors
4. Verify session and authentication status

VERSION INFO
------------
Version:      1.0
Released:     December 2024
PHP Version:  7.4+
MySQL:        5.7+

===============================================
           END OF QUICK REFERENCE
===============================================
